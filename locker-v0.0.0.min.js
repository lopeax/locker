var Class=function(a){var b=function(){this.initialize.apply(this,arguments)},c;for(c in a)b.prototype[c]=a[c];b.prototype.initialize||(b.prototype.initialize=function(){});return b},Locker=Class({extend:function(){var a={},b=!1,c=0,d=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],c++);for(;c<d;c++){var e=arguments[c],f=void 0;for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(b&&"[object Object]"===Object.prototype.toString.call(e[f])?a[f]=
extend(!0,a[f],e[f]):a[f]=e[f])}return a},hypot:function(){for(var a=0,b=arguments.length,c=0;c<b;c++){if(Infinity===arguments[c]||-Infinity===arguments[c])return Infinity;a+=arguments[c]*arguments[c]}return Math.sqrt(a)},initialize:function(a){this.opts=this.extend({wrap:".locker",height:320,width:320,background:"#333333",centered:!0,drawing:"#FFFFFF",saved:"#0088CC",success:"#00CC88",error:"#EF5350",cap:4,pointscolour:"#FFFFFF",pointsize:5,pointhoversize:7,pointboundary:22,strokewidth:2,timer:1E3,
debug:!1},a);this.wrap=document.querySelector(this.opts.wrap);document.contains(this.wrap)&&0==this.wrap.getElementsByTagName("canvas").length&&(this.wrap.style.height=this.opts.height.toString()+"px",this.wrap.style.width=this.opts.width.toString()+"px",this.wrap.style.backgroundColor=this.opts.background,document.body.style.overflowY="hidden",this.opts.centered&&(this.wrap.style.position="fixed",this.wrap.style.top="50%",this.wrap.style.left="50%",this.wrap.style.webkitTransform="translate(-50%, -50%)",
this.wrap.style.transform="translate(-50%, -50%)"),this.linecanvas=this.addCanvas(),this.linectx=this.linecanvas.getContext("2d"),this.pointscanvas=this.addCanvas(),this.pointsctx=this.pointscanvas.getContext("2d"),this.localSavedPattern="lockpattern-"+Date.now(),this.mouse={x:-1,y:-1},this.p={x:-1,y:-1},this.count=0,this.makePoints(),this.drawPoints(),this.saved=!1,this.opts.debug&&(this["debugger"]=this.addDebugger()),this.wrap.addEventListener("mousedown",this.dragStart.bind(this)),this.wrap.addEventListener("mousemove",
this.dragMove.bind(this)),this.wrap.addEventListener("mouseup",this.dragEnd.bind(this)),this.wrap.addEventListener("touchend",this.dragEnd.bind(this)),this.wrap.addEventListener("touchmove",this.dragMove.bind(this)),this.wrap.addEventListener("touchstart",this.dragStart.bind(this)))},executeAfter:function(){var a={};return function(b,c,d){d||(d="Timer-"+Date.now().toString());a[d]&&clearTimeout(a[d]);a[d]=setTimeout(b,c)}}(),allPointsFilled:function(a){for(var b=a.length;b--;)if(!1===a[b].s)return!1;
return!0},addCanvas:function(){var a=document.createElement("canvas");a.height=this.opts.height;a.width=this.opts.width;a.style.position="absolute";a.style.top="0";a.style.left="0";a.style.zIndex="-1";this.wrap.appendChild(a);return a},addDebugger:function(){var a=document.createElement("div");a.className="locker-debugger";a.style.position="absolute";a.style.width="100%";a.style.top="calc(100% + 15px)";a.style.fontSize="15px";a.style.textAlign="center";this.wrap.appendChild(a);return a},debugEvent:function(a){this["debugger"].innerHTML=
"Event type: "+a.type;this["debugger"].innerHTML="touchstart"==a.type||"touchmove"==a.type||"touchend"==a.type?this["debugger"].innerHTML+(" x: "+a.targetTouches[0].pageX+" y: "+a.targetTouches[0].pageY+" top: "+a.target.getBoundingClientRect().top+" left: "+a.target.getBoundingClientRect().left):this["debugger"].innerHTML+(" x: "+a.offsetX+" y: "+a.offsetY)},makePoints:function(){this.points=[{x:this.opts.width/4,y:this.opts.height/4,s:!1,id:1},{x:this.opts.width/2,y:this.opts.height/4,s:!1,id:2},
{x:3*this.opts.width/4,y:this.opts.height/4,s:!1,id:3},{x:this.opts.width/4,y:this.opts.height/2,s:!1,id:4},{x:this.opts.width/2,y:this.opts.height/2,s:!1,id:5},{x:3*this.opts.width/4,y:this.opts.height/2,s:!1,id:6},{x:this.opts.width/4,y:3*this.opts.height/4,s:!1,id:7},{x:this.opts.width/2,y:3*this.opts.height/4,s:!1,id:8},{x:3*this.opts.width/4,y:3*this.opts.height/4,s:!1,id:9}]},savePoints:function(a){localStorage.setItem(this.localSavedPattern,JSON.stringify(a));this.saved=!0;a=navigator.userAgent.match(/iPad/i)?
"touchstart":"click";var b=this.addReset();b.addEventListener(a,function(){this.resetSavedPoints(b)}.bind(this))},matchPoints:function(a){for(var b=JSON.parse(localStorage.getItem(this.localSavedPattern)),c=0;c<b.length;c++)!1===b[c].s&&(b[c]="unused");for(c=0;c<a.length;c++)!1===a[c].s&&(a[c]="unused");b=this.sortPoints(b);a=this.sortPoints(a);return JSON.stringify(a)===JSON.stringify(b)},resetSavedPoints:function(a){localStorage.removeItem(this.localSavedPattern);a.remove();this.saved=!1},addReset:function(){var a=
document.createElement("div");a.innerHTML="Reset";a.style.backgroundColor="#fff";a.style.color="#333";a.style.borderRadius="0.2em";a.style.padding="7px 10px";a.style.cursor="pointer";a.style.position="absolute";a.style.top="20px";a.style.left="50%";a.style.webkitTransform="translateX(-50%)";a.style.transform="translateX(-50%)";a.style.zIndex="0";this.wrap.appendChild(a);return a},sortPoints:function(a){return a.sort(function(a,c){return!1===a.s?1:!1===c.s?-1:a.s===c.s?0:a.s<c.s?-1:1})},drawPoint:function(a,
b,c,d){this.pointsctx.beginPath();this.pointsctx.arc(a,b,c,0,2*Math.PI);this.pointsctx.strokeStyle=d;this.pointsctx.stroke();this.pointsctx.fillStyle=d;this.pointsctx.fill()},clearPoint:function(a,b,c){this.pointsctx.clearRect(a-2,b-2,c+4,c+4)},growPoint:function(a){var b=this.opts.pointsize,c,d=this;(function f(){b<=d.opts.pointhoversize?(d.clearPoint(a.x,a.y,2*b),b+=.23,d.drawPoint(a.x,a.y,b,d.opts.pointscolour),c=window.requestAnimationFrame(f)):(window.cancelAnimationFrame(c),c=void 0)})()},shrinkPoint:function(a){var b=
this.opts.pointhoversize,c,d=this;(function f(){b>=d.opts.pointsize?(d.clearPoint(a.x-b,a.y-b,2*b),b+=-.23,d.drawPoint(a.x,a.y,b,d.opts.pointscolour),c=window.requestAnimationFrame(f)):(window.cancelAnimationFrame(c),c=void 0)})()},drawPoints:function(){for(var a=0;a<this.points.length;a++)this.drawPoint(this.points[a].x,this.points[a].y,this.opts.pointsize,this.opts.drawing)},clearPoints:function(){this.pointsctx.clearRect(0,0,this.opts.width,this.opts.height)},clearLocker:function(a){this.clearLine();
this.colourShift(this.points,this.opts.drawing,a);this.executeAfter(function(){this.clearLine();for(var a=0;a<this.points.length;a++)!1!==this.points[a].s&&(this.shrinkPoint(this.points[a]),this.points[a].s=!1);this.makePoints()}.bind(this),this.opts.timer)},drawLine:function(a,b,c,d,e){this.linectx.beginPath();this.linectx.moveTo(a,b);this.linectx.lineTo(c,d);this.linectx.strokeStyle=e;this.linectx.lineWidth=this.opts.strokewidth;this.linectx.stroke()},clearLine:function(){this.linectx.clearRect(0,
0,this.opts.width,this.opts.height)},drawExistingLine:function(a,b){for(var c=0;c<a.length-1;c++)!1!==a[c].s&&!1!==a[c+1].s&&this.drawLine(a[c].x,a[c].y,a[c+1].x,a[c+1].y,b)},drawExistingPartialLine:function(a,b){for(var c=0;c<a.length-2;c++)!1!==a[c].s&&!1!==a[c+1].s&&!1!==a[c+2].s&&this.drawLine(a[c].x,a[c].y,a[c+1].x,a[c+1].y,b)},drawExistingIntersectingPartialLine:function(a,b){for(var c=0;c<a.length-3;c++)!1!==a[c].s&&!1!==a[c+1].s&&!1!==a[c+2].s&&!1!==a[c+3].s&&this.drawLine(a[c].x,a[c].y,a[c+
1].x,a[c+1].y,b)},snapLine:function(a,b,c){var d=b.x,e=b.y,f=c.x-b.x,m=c.y-b.y;b=Math.max.apply(Math,this.points.map(function(a){return a.s}));b=this.points.map(function(a){return a.s}).indexOf(b);for(var h=!1,k=0;k<this.points.length;k++)if(this.intersects(c,a,this.points[k])){this.growPoint(this.points[k]);this.points[k].s=this.count;this.count++;this.points[b].s=this.count;this.count++;h=!0;break}var l,g=this,n=0;(function q(){10>n?(h?(g.clearLine(),g.drawExistingIntersectingPartialLine(g.points,
g.opts.drawing)):(g.clearLine(),g.drawExistingPartialLine(g.points,g.opts.drawing)),g.drawLine(a.x,a.y,d,e,g.opts.drawing),d+=f/10,e+=m/10,l=window.requestAnimationFrame(q),n++):(g.clearLine(),g.drawExistingPartialLine(g.points,g.opts.drawing),g.drawLine(a.x,a.y,c.x,c.y,g.opts.drawing),window.cancelAnimationFrame(l),l=void 0)})()},hexToRgb:function(a){a="#"==a.charAt(0)?a.substring(1,7):a;return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},rgbToHex:function(a){var b=
a.indexOf("(")+1;if("rgb"===a.substring(0,b-1)){var c=function(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)},d=a.indexOf(")",b);a=a.substring(b,d).split(",");return"#"+c(a[0])+c(a[1])+c(a[2])}return"Sorry, this isn't an rgb colour"},colourShift:function(a,b,c){b=this.hexToRgb(b);var d=this.hexToRgb(c),e,f,m;e=d[0]<b[0]?Math.floor((d[0]-b[0])/10):d[0]>b[0]?Math.floor((b[0]-d[0])/10):0;f=d[1]<b[1]?
Math.floor((d[1]-b[1])/10):d[1]>b[1]?Math.floor((b[1]-d[1])/10):0;m=d[2]<b[2]?Math.floor((d[2]-b[2])/10):d[2]>b[2]?Math.floor((b[2]-d[2])/10):0;var h=[b[0],b[1],b[2]],k,l=this,g=0;(function p(){if(10>g){l.clearLine();var b=h;h=[b[0]+e,b[1]+f,b[2]+m];l.drawExistingLine(a,l.rgbToHex("rgb("+h[0]+","+h[1]+","+h[2]+")"));k=window.requestAnimationFrame(p);g++}else l.clearLine(),l.drawExistingLine(a,c),window.cancelAnimationFrame(k),k=void 0})()},intersects:function(a,b,c){if(-1<a.x&&-1<a.y&&-1<b.x&&-1<
b.y&&-1<c.x&&-1<c.y&&!(a.x==b.x&&a.y==b.y||a.x==c.x&&a.y==c.y||b.x==c.x&&b.y==c.y)){var d=this.hypot(b.x-a.x,b.y-a.y);a=this.hypot(c.x-a.x,c.y-a.y);b=this.hypot(b.x-c.x,b.y-c.y);if(a+b==d&&!1===c.s)return a+b==d}},dragStart:function(a){this.mouse={x:a.offsetX,y:a.offsetY};"touchstart"==a.type&&(this.mouse={x:a.targetTouches[0].pageX-a.target.getBoundingClientRect().left,y:a.targetTouches[0].pageY-a.target.getBoundingClientRect().top});this.opts.debug&&this.debugEvent(a)},dragMove:function(a){var b=
a.offsetX,c=a.offsetY;"touchmove"==a.type&&(b=a.targetTouches[0].pageX-a.target.getBoundingClientRect().left,c=a.targetTouches[0].pageY-a.target.getBoundingClientRect().top);var d={x:this.p.x,y:this.p.y};if(-1<this.mouse.x&&-1<this.mouse.y)if(this.clearLine(),this.allPointsFilled(this.points))this.drawExistingLine(this.points,this.opts.drawing);else{for(var e=0;e<this.points.length;e++){var f=this.points[e].x+this.opts.pointboundary,m=this.points[e].y-this.opts.pointboundary,h=this.points[e].y+this.opts.pointboundary;
b>this.points[e].x-this.opts.pointboundary&&b<f&&c>m&&c<h&&!1===this.points[e].s&&(this.p.x=this.points[e].x,this.p.y=this.points[e].y,this.points[e].s=this.count,this.count++,this.growPoint(this.points[e]))}this.points=this.sortPoints(this.points);this.drawExistingLine(this.points,this.opts.drawing);-1<this.p.x&&-1<this.p.y&&-1<d.x&&-1<d.y&&(this.p.x==d.x&&this.p.y==d.y||this.snapLine(d,{x:b,y:c},this.p),this.drawLine(this.p.x,this.p.y,b,c,this.opts.drawing))}this.opts.debug&&this.debugEvent(a)},
dragEnd:function(a){this.mouse={x:-1,y:-1};var b=this.points;this.p.x=-1;this.p.y=-1;this.count=0;this.points.filter(function(a){return!1!==a.s}).length>=this.opts.cap?this.saved?this.matchPoints(b)?this.clearLocker(this.opts.success):this.clearLocker(this.opts.error):(this.savePoints(b),this.clearLocker(this.opts.saved)):this.clearLocker(this.opts.error);this.opts.debug&&this.debugEvent(a)}});
